(()=>{"use strict";var e=document.querySelector("#darkmodbtn"),t=(window.matchMedia("(prefers-color-scheme: dark)"),document.querySelector("#btnfermer")),n=document.querySelector("#modal"),a=localStorage.getItem("dark-theme"),o=document.querySelector("#deleteAll"),r=document.querySelector("#searchbar"),d={parentElementId:null,editingTaskElement:null};e.addEventListener("click",(function(){document.querySelectorAll("*").forEach((function(e){e.classList.toggle("dark-theme")})),document.body.classList.contains("dark-theme")?localStorage.setItem("dark-theme","true"):localStorage.setItem("dark-theme","false")})),!a&&isDarkSchemePreferred?(localStorage.setItem("dark-theme","true"),document.body.classList.add("dark-theme")):a?"true"===a&&document.body.classList.add("dark-theme"):localStorage.setItem("dark-theme","false"),"true"===localStorage.getItem("dark-theme")&&(document.querySelectorAll("*").forEach((function(e){e.classList.add("dark-theme")})),document.querySelectorAll(".newTaskTemplate *").forEach((function(e){e.classList.add("dark-theme")})));var c=null,l=null;function s(){document.querySelectorAll(".task").forEach((function(e){e.addEventListener("dragstart",(function(t){t.dataTransfer.setData("text",e.id)})),e.addEventListener("dragover",(function(t){t.preventDefault();var n=e.getBoundingClientRect(),a=n.y+n.height/2;l=t.clientY-n.y<a?"above":"below",c=e})),e.addEventListener("drop",(function(t){var n=t.dataTransfer.getData("text"),a=document.getElementById(n);"above"===l?e.parentNode.insertBefore(a,e):e.nextSibling&&e.nextSibling.classList.contains("task")?e.parentNode.insertBefore(a,e.nextSibling):e.parentNode.appendChild(a),u()})),e.addEventListener("dragleave",(function(){e.classList.remove("drop-above","drop-below"),c=null}))}))}var i=document.querySelector("#app");function u(){var e=document.querySelectorAll(".task"),t=Array.from(e).map((function(e){return{id:e.id,name:e.querySelector(".nomDeTâche").textContent,description:e.querySelector(".description").textContent,date:e.querySelector(".date").textContent,parent:e.parentElement.id}}));localStorage.setItem("tasks",JSON.stringify(t))}i.addEventListener("dragover",(function(e){e.preventDefault()})),i.addEventListener("drop",(function(e){var t=e.dataTransfer.getData("text"),n=document.getElementById(t);if(!c){var a=document.querySelector("#todoTask"),o=document.querySelector("#DoingTask"),r=document.querySelector("#DoneTask"),d={todoTask:Math.abs(a.getBoundingClientRect().top+a.getBoundingClientRect().height/2-e.clientY),DoingTask:Math.abs(o.getBoundingClientRect().top+o.getBoundingClientRect().height/2-e.clientY),DoneTask:Math.abs(r.getBoundingClientRect().top+r.getBoundingClientRect().height/2-e.clientY)},l=Object.keys(d).reduce((function(e,t){return d[e]<d[t]?e:t}));document.querySelector("#".concat(l)).appendChild(n)}u()})),t.addEventListener("click",(function(e){e.preventDefault(),n.style.display="none"})),o.addEventListener("click",(function(){document.querySelectorAll("#DoneTask .task").forEach((function(e){e.remove()})),u()})),document.addEventListener("click",(function(e){if(e.target.classList.contains("checkmark")){var t=e.target.closest(".task");t&&t instanceof Node&&(document.getElementById("DoneTask").appendChild(t),t.querySelector(".checkmark").remove(),u())}if(e.target.classList.contains("can")){var a=e.target.closest(".task");a&&a instanceof Node&&a.remove(),u()}if(e.target.classList.contains("pen")){var o=e.target.closest(".task"),r=o.querySelector(".nomDeTâche").textContent,c=o.querySelector(".description").textContent,l=o.querySelector(".date").textContent,s=document.getElementById("nameTask"),i=document.getElementById("descrimodal"),m=document.getElementById("datemodal"),y=document.getElementById("btnmodal");s.value=r,i.value=c,m.value=l,y.textContent="Modify",n.style.display="flex",d.editingTaskElement=o}})),document.querySelectorAll(".addTask").forEach((function(e){e.addEventListener("click",(function(e){d.parentElementId=e.target.parentNode.id,n.style.display="flex",document.getElementById("btnmodal").textContent="Add a task"}))})),document.getElementById("btnmodal").addEventListener("click",(function(e){e.preventDefault();var t=document.getElementById("nameTask").value,a=document.getElementById("descrimodal").value,o=document.getElementById("datemodal").value;if(d.editingTaskElement)d.editingTaskElement.querySelector(".nomDeTâche").textContent=t,d.editingTaskElement.querySelector(".description").textContent=a,d.editingTaskElement.querySelector(".date").textContent=o,d.editingTaskElement=null,u();else{var r=document.querySelector(".newTaskTemplate").content.cloneNode(!0);r.querySelector(".nomDeTâche").textContent=t,r.querySelector(".date").textContent=o,r.querySelector(".description").textContent=a,document.body.classList.contains("dark-theme")&&(r.querySelector(".nomDeTâche").classList.add("dark-theme"),r.querySelector(".date").classList.add("dark-theme"),r.querySelector(".description").classList.add("dark-theme"));var c=document.getElementById(d.parentElementId);r.querySelector(".task").setAttribute("id","task"+Date.now()),c.appendChild(r)}document.getElementById("nameTask").value="",document.getElementById("descrimodal").value="",document.getElementById("datemodal").value="",n.style.display="none",s(),u()})),r.addEventListener("input",(function(e){var t=e.target.value.toLowerCase(),n=Array.from(document.querySelectorAll(".task"));""!==t?n.forEach((function(e){var n=e.querySelector(".nomDeTâche"),a=e.querySelector(".description"),o=n?n.textContent.toLowerCase():"",r=a?a.textContent.toLowerCase():"";o.includes(t)||r.includes(t)?e.style.display="flex":e.style.display="none"})):n.forEach((function(e){return e.style.display="flex"}))})),(JSON.parse(localStorage.getItem("tasks"))||[]).forEach((function(e){var t=document.querySelector(".newTaskTemplate").content.cloneNode(!0);t.querySelector(".task").id=e.id,t.querySelector(".nomDeTâche").textContent=e.name,t.querySelector(".description").textContent=e.description,t.querySelector(".date").textContent=e.date,document.body.classList.contains("dark-theme")&&(t.querySelector(".nomDeTâche").classList.add("dark-theme"),t.querySelector(".date").classList.add("dark-theme"),t.querySelector(".description").classList.add("dark-theme")),document.getElementById(e.parent).appendChild(t)})),s()})();